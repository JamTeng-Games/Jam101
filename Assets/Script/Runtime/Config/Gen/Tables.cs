
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using cfg.item;
using Jam.Runtime;
using Jam.Runtime.Asset;
using Jam.Runtime.Constant;
using SimpleJSON;
using UnityEngine;

namespace cfg
{
public partial class Tables
{
    private System.Action<bool> _onLoadedDone;
    private int _totalCount = 0;
    private int _loadCount = 0;
    private bool _anyCfgLoadFailed = false;

    public item.TbItem TbItem { get; private set; }
    public TbReward TbReward { get; private set; }
    public TbUIPanelConfig TbUIPanelConfig { get; private set; }
    public TbUIWidgetConfig TbUIWidgetConfig { get; private set; }

    private void LoadCfgImpl(System.Action<bool> onLoadedDone)
    {
        _onLoadedDone = onLoadedDone;
        _totalCount++;
        G.Asset.Load(GetAssetPath("item_tbitem"), typeof(TextAsset), LoadAssetCallback, "item_tbitem");
        _totalCount++;
        G.Asset.Load(GetAssetPath("tbreward"), typeof(TextAsset), LoadAssetCallback, "tbreward");
        _totalCount++;
        G.Asset.Load(GetAssetPath("tbuipanelconfig"), typeof(TextAsset), LoadAssetCallback, "tbuipanelconfig");
        _totalCount++;
        G.Asset.Load(GetAssetPath("tbuiwidgetconfig"), typeof(TextAsset), LoadAssetCallback, "tbuiwidgetconfig");
    }

    private void ResolveRef()
    {
        TbItem.ResolveRef(this);
        TbReward.ResolveRef(this);
        TbUIPanelConfig.ResolveRef(this);
        TbUIWidgetConfig.ResolveRef(this);
    }

    private void LoadAssetCallback(AssetHandleWrap wrap)
    {
        if (_anyCfgLoadFailed)
            return;

        if (!wrap.IsSuccess)
        {
            _anyCfgLoadFailed = true;
            _onLoadedDone?.Invoke(false);
            return;
        }

        _loadCount++;
        string jsonText = ((TextAsset)wrap.Asset).text;
        JSONNode json = JSONNode.Parse(jsonText);

        if ((string)wrap.UserData == "item_tbitem")
        {
            TbItem = new item.TbItem(json);
        }
        if ((string)wrap.UserData == "tbreward")
        {
            TbReward = new TbReward(json);
        }
        if ((string)wrap.UserData == "tbuipanelconfig")
        {
            TbUIPanelConfig = new TbUIPanelConfig(json);
        }
        if ((string)wrap.UserData == "tbuiwidgetconfig")
        {
            TbUIWidgetConfig = new TbUIWidgetConfig(json);
        }

        if (_loadCount == _totalCount)
        {
            ResolveRef();
            _onLoadedDone?.Invoke(true);
        }
    }

    private string GetAssetPath(string assetName)
    {
        return AssetPath.Cfg(assetName, false);
    }
}

}
